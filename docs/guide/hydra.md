
## Введение
Hydra (https://hydra.cc/docs/intro/) — это фреймворк Python с открытым исходным кодом, который упрощает разработку кода для исследований и других сложных приложений. Ключевой особенностью является возможность динамически создавать иерархическую конфигурацию и переопределять ее с помощью файлов конфигурации и командной строки.
## Использование в "MultiPinn"
В программном комплексе Hydra используется для удобства проведения различных экспериментов и подбора гиперпараметров. 
Каждая задача представляет собой директорию с Python файлом, содержащим само уравнение/систему, Python файлом решения и конфигурацией в файле "config.yaml".
На данный момент файлы с  конфигурацией содержат следующие параметры:

 * net: параметры архитектуры нейронной сети
	 * type: один из типов FNN / ResNet
	 * layers: размер слоев, если архитектура – FNN
	 * blocks: размер блоков, если архитектура – ResNet
  * params: параметры обучения
	  * domain_points: количество точек для генератора внутренней области
	  * bound_points: количество точек для генератора границы
	  * condition_index: номер Condition внутренней области
	  * num_epochs: количество эпох обучения
	  * grid_update: частота обновления точек
	  * grid_plot_points: количество точек для сетки графика
	  * save_period: частота использования функций обратного вызова (LossCurve, SaveModel, HeatmapPrediction, etc.)
	  * random_seed
	  * save_mode: режим сохранения графиков
* regularization: параметры и тип регулиризации
  * name: "" – для обучения без регуляризации, "Pointwise" – для поточечной регуляризации, "Const" – для константной регуляризации
  * lambdas: числа для константной регуляризации
 * scheduler_params: параметры планировщика (скорости обучения)
   * gamma: в данном случае, параметр для torch.optim.lr_scheduler.ExponentialLR
 * optimizer: параметры оптимизатора
   * lr: скорость обучения
 
 Эти параметры можно изменить как вручную в файле "config.yaml", так и в командной строке.
 ## Примеры
Также в зависимости от задачи в файле с конфигурацией могут содержаться дополнительные параметры.

Рассмотрим задачу конвекции (examples/convection), файл "config.yaml" содержит в себе параметры, при изменении которых изменятся и соответствующие параметры в файле "convection_pinnsolution.py".

Помимо основных параметров, описанных выше, данная конфигурация также содержит параметры *betta* и *t_max*, имеющиеся в задаче конвекции.
При каждом запуске файла "convection_pinnsolution.py" в директории "outputs" сохраняются параметры эксперимента и логи для удобного воспроизведения.
### Группы конфигураций
Для экспериментов с различными комбинациями наборов параметров могут помочь группы конфигураций. Они представляют из себя отдельные конфигурации для каждой подсистемы проекта.
Изменим структуру convection, добавим в папку config подпапку для управления параметрами *betta, t_max*:

```
config
- betta_t
  - betta_t_1.yaml
  - betta_t_2.yaml
- config.yaml
convection_pinnsolution.py
convection_problem.py
```
Config остается прежним, а два новых файла выглядят следующим образом:
```
#betta_t_1.yaml
name: betta_t_1
betta: 0.5  
t_max: 1
```

```
#betta_t_2.yaml
name: betta_t_2
betta: 1  
t_max: 5
```
Далее при запуске нам нужно указать какой конфиг использовать:
```
> python3 convection_pinnsolution.py conv_params=betta_t_1
```
### Multirun
Hydra может запускать каждый модуль по отдельности в автоматическом режиме:
```
> python3 convection_pinnsolution.py -m conv_params=betta_t_1,betta_t_2
```
В отличии от одиночного запуска при мульти-запуске логи сохраняются в папке multirun, в которой помимо даты и времени также создается отдельная подпапка (с порядковым номером) для каждого отдельного задания.
